import java.util.*;

public class Stack_Day3_Advanced {

    // ==================================================
    // Maximum Area in Histogram
    // ==================================================
    public static void maxArea(int arr[]) {
        int n = arr.length;
        int maxArea = 0;
        int nsr[] = new int[n];
        int nsl[] = new int[n];
        Stack<Integer> s = new Stack<>();

        // Next Smaller Right
        for (int i = n - 1; i >= 0; i--) {
            while (!s.isEmpty() && arr[s.peek()] >= arr[i]) {
                s.pop();
            }
            nsr[i] = s.isEmpty() ? n : s.peek();
            s.push(i);
        }

        s.clear();

        // Next Smaller Left
        for (int i = 0; i < n; i++) {
            while (!s.isEmpty() && arr[s.peek()] >= arr[i]) {
                s.pop();
            }
            nsl[i] = s.isEmpty() ? -1 : s.peek();
            s.push(i);
        }

        for (int i = 0; i < n; i++) {
            int height = arr[i];
            int width = nsr[i] - nsl[i] - 1;
            maxArea = Math.max(maxArea, height * width);
        }

        System.out.println("Max Histogram Area: " + maxArea);
    }

    // ==================================================
    // Simplify Unix Path
    // ==================================================
    public static String simplify(String path) {
        Stack<String> s = new Stack<>();
        String[] parts = path.split("/");

        for (String part : parts) {
            if (part.equals("") || part.equals(".")) continue;
            if (part.equals("..")) {
                if (!s.isEmpty()) s.pop();
            } else {
                s.push(part);
            }
        }

        StringBuilder res = new StringBuilder("/");
        for (int i = 0; i < s.size(); i++) {
            res.append(s.get(i));
            if (i != s.size() - 1) res.append("/");
        }
        return res.toString();
    }

    // ==================================================
    // Decode Encoded String
    // ==================================================
    public static String decode(String str) {
        Stack<Integer> numStack = new Stack<>();
        Stack<String> strStack = new Stack<>();
        String curr = "";
        int num = 0;

        for (char ch : str.toCharArray()) {
            if (Character.isDigit(ch)) {
                num = num * 10 + (ch - '0');
            } else if (ch == '[') {
                numStack.push(num);
                strStack.push(curr);
                curr = "";
                num = 0;
            } else if (ch == ']') {
                int times = numStack.pop();
                String prev = strStack.pop();
                curr = prev + curr.repeat(times);
            } else {
                curr += ch;
            }
        }
        return curr;
    }

    // ==================================================
    // Trapping Rain Water
    // ==================================================
    public static int trappingRainWater(int arr[]) {
        Stack<Integer> s = new Stack<>();
        int water = 0;

        for (int i = 0; i < arr.length; i++) {
            while (!s.isEmpty() && arr[s.peek()] < arr[i]) {
                int height = arr[s.pop()];
                if (s.isEmpty()) break;
                int distance = i - s.peek() - 1;
                int boundedHeight = Math.min(arr[i], arr[s.peek()]) - height;
                water += distance * boundedHeight;
            }
            s.push(i);
        }
        return water;
    }

    // ==================================================
    // Main
    // ==================================================
    public static void main(String[] args) {
        int hist[] = {2, 1, 5, 6, 2, 3};
        maxArea(hist);

        System.out.println(simplify("/a/./b/../../c/"));
        System.out.println(decode("a3[b]c2[d]"));

        int rain[] = {7,0,4,2,5,0,6,4,0,5};
        System.out.println("Trapped Water: " + trappingRainWater(rain));
    }
}
